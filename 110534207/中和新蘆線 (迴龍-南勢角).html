<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台北捷運中和新蘆線 (迴龍-南勢角) 路線圖</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh; margin: 0; background-color: #f0f2f5; }
    h1 { color: #f8b61c; }
    #map-container { display: flex; align-items: center; width: 95%; max-width: 1400px; }
    #map { width: 100%; overflow-x: auto; padding: 20px 0; }
    .station-circle { cursor: pointer; fill: white; stroke: #f8b61c; stroke-width: 4; transition: r 0.2s ease-in-out; }
    .station-circle:hover { r: 12; }
    .station-text { font-size: 12px; font-weight: bold; text-anchor: middle; pointer-events: none; }
    #sidebar {
        width: 300px;
        min-height: 400px;
        border: 2px solid #f8b61c;
        border-radius: 10px;
        padding: 20px;
        margin-left: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #auth-section { text-align: center; margin-bottom: 15px; }
    #auth-section button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 14px; }
    #login-btn { background-color: #f8b61c; color: white; }
    #logout-btn { background-color: #e41c1c; }
    #admin-status { font-weight: bold; color: #e41c1c; }
    #info-panel { flex-grow: 1; display: flex; flex-direction: column; }
    #info-panel-content { flex-grow: 1; overflow-y: auto; }
    #info-panel h2, #info-panel p { text-align: center; margin: 0 0 10px 0; color: #f8b61c; }
    #info-panel ul { list-style-type: none; padding: 0; margin: 0; }
    #info-panel li { background-color: #e6f2ff; margin-bottom: 8px; padding: 10px; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .delete-btn { background: #e41c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; padding: 3px 8px; }
    #add-attraction-form { margin-top: 15px; display: flex; }
    #add-attraction-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
    #add-attraction-btn { background: #f8b61c; color: white; border: none; border-radius: 4px; margin-left: 5px; padding: 8px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>台北捷運 - 中和新蘆線 (迴龍-南勢角)</h1>

<div id="map-container">
    <div id="map">
        <svg id="orange-line-svg" width="100%" height="150"></svg>
    </div>
    <div id="sidebar">
        <div id="auth-section">
            <button id="login-btn">管理員登入</button>
            <button id="logout-btn" style="display:none;">登出</button>
            <p id="admin-status" style="display:none;">管理員模式</p>
        </div>
        <div id="info-panel">
            <div id="info-panel-content">
                <h2>附近景點</h2>
                <p>請點選站點</p>
                <ul></ul>
            </div>
            <div id="add-attraction-form" style="display:none;">
                <input type="text" id="add-attraction-input" placeholder="輸入新景點...">
                <button id="add-attraction-btn">新增</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBALS ---
document.addEventListener('DOMContentLoaded', main);
const LOCAL_STORAGE_KEY = 'orangeHuilongLineMapData'; // Unique key
let isAdmin = false;
let currentStationId = null;
let stations = [];

// --- MAIN FUNCTION ---
function main() {
    initData();
    setupEventListeners();
    drawMap();
}

// --- DATA MANAGEMENT ---
function initData() {
    const savedStations = localStorage.getItem(LOCAL_STORAGE_KEY);
    if (savedStations) {
        stations = JSON.parse(savedStations);
    } else {
        stations = getDefaultStations();
        saveData();
    }
}

function saveData() {
    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(stations));
}

// --- AUTH & EVENT LISTENERS ---
function setupEventListeners() {
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('logout-btn').addEventListener('click', logout);
    document.getElementById('add-attraction-btn').addEventListener('click', addAttraction);
}

function login() {
    const password = prompt('請輸入管理員密碼:');
    if (password === '123') {
        isAdmin = true;
        toggleAdminView(true);
        if(currentStationId) updateInfoPanel(currentStationId);
    } else {
        alert('密碼錯誤!');
    }
}

function logout() {
    isAdmin = false;
    toggleAdminView(false);
    if(currentStationId) updateInfoPanel(currentStationId);
}

function toggleAdminView(isAdminState) {
    document.getElementById('login-btn').style.display = isAdminState ? 'none' : 'block';
    document.getElementById('logout-btn').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('admin-status').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('add-attraction-form').style.display = isAdminState && currentStationId ? 'flex' : 'none';
}

// --- UI & CRUD ---
function updateInfoPanel(stationId) {
    currentStationId = stationId;
    const station = stations.find(s => s.id === stationId);
    const panel = document.getElementById('info-panel-content');
    panel.innerHTML = `<h2>${station.name}</h2><p>(${station.id})</p><ul></ul>`;
    const list = panel.querySelector('ul');

    if (station.attractions && station.attractions.length > 0) {
        station.attractions.forEach(attraction => {
            const li = document.createElement('li');
            li.textContent = attraction;
            if (isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteAttraction(attraction);
                li.appendChild(deleteBtn);
            }
            list.appendChild(li);
        });
    } else {
        list.innerHTML = '<li>尚無景點資訊</li>';
    }
    document.getElementById('add-attraction-form').style.display = isAdmin ? 'flex' : 'none';
}

function addAttraction() {
    const input = document.getElementById('add-attraction-input');
    const newAttraction = input.value.trim();
    if (!newAttraction || !currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        if (!stationToUpdate.attractions) stationToUpdate.attractions = [];
        stationToUpdate.attractions.push(newAttraction);
        saveData();
        updateInfoPanel(currentStationId);
    }
    input.value = '';
}

function deleteAttraction(attractionName) {
    if (!currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        stationToUpdate.attractions = stationToUpdate.attractions.filter(a => a !== attractionName);
        saveData();
        updateInfoPanel(currentStationId);
    }
}

// --- MAP DRAWING ---
function drawMap() {
    const svg = document.getElementById("orange-line-svg");
    const svgWidth = stations.length * 60;
    svg.setAttribute("width", svgWidth);
    const lineY = 75;

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", 30); line.setAttribute("y1", lineY);
    line.setAttribute("x2", svgWidth - 30); line.setAttribute("y2", lineY);
    line.setAttribute("stroke", "#f8b61c"); line.setAttribute("stroke-width", 8);
    svg.appendChild(line);

    stations.forEach((station, index) => {
        const x = index * 60 + 30;
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("class", "station-circle");
        circle.setAttribute("cx", x); circle.setAttribute("cy", lineY); circle.setAttribute("r", 10);
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("class", "station-text");
        text.setAttribute("x", x); text.setAttribute("y", lineY + 35);
        text.textContent = station.name;
        svg.appendChild(text);

        circle.addEventListener("click", () => updateInfoPanel(station.id));
    });
}

// --- DEFAULT DATA ---
function getDefaultStations() {
    return [
        { id: 'O01', name: '南勢角', attractions: ['興南夜市'] },
        { id: 'O02', name: '景安', attractions: ['(可轉乘環狀線)'] },
        { id: 'O03', name: '永安市場', attractions: ['國立臺灣圖書館'] },
        { id: 'O04', name: '頂溪', attractions: ['樂華夜市'] },
        { id: 'O05', name: '古亭', attractions: ['(可轉乘松山新店線)'] },
        { id: 'O06', name: '東門', attractions: ['永康街', '(可轉乘淡水信義線)'] },
        { id: 'O07', name: '忠孝新生', attractions: ['華山1914', '(可轉乘板南線)'] },
        { id: 'O08', name: '松江南京', attractions: ['(可轉乘松山新店線)'] },
        { id: 'O09', name: '行天宮', attractions: ['行天宮'] },
        { id: 'O10', name: '中山國小', attractions: [] },
        { id: 'O11', name: '民權西路', attractions: ['(可轉乘淡水信義線)'] },
        { id: 'O12', name: '大橋頭', attractions: ['迪化街', '(往迴龍/蘆洲)'] },
        { id: 'O13', name: '台北橋', attractions: [] },
        { id: 'O14', name: '菜寮', attractions: [] },
        { id: 'O15', name: '三重', attractions: ['(可轉乘機場捷運)'] },
        { id: 'O16', name: '先嗇宮', attractions: [] },
        { id: 'O17', name: '頭前庄', attractions: ['(可轉乘環狀線)'] },
        { id: 'O18', name: '新莊', attractions: ['新莊廟街'] },
        { id: 'O19', name: '輔大', attractions: ['輔仁大學'] },
        { id: 'O20', name: '丹鳳', attractions: [] },
        { id: 'O21', name: '迴龍', attractions: [] }
    ].reverse();
}

</script>
</body>
</html>