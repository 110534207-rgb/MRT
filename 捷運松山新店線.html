<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台北捷運松山新店線路線圖 (可編輯版)</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh; margin: 0; background-color: #f0f8f2; }
    h1 { color: #008659; }
    #map-container { display: flex; align-items: center; width: 95%; max-width: 1400px; }
    #map { width: 100%; overflow-x: auto; padding: 20px 0; }
    .station-circle { cursor: pointer; fill: white; stroke: #008659; stroke-width: 4; transition: r 0.2s ease-in-out; }
    .station-circle:hover { r: 12; }
    .station-text { font-size: 12px; font-weight: bold; text-anchor: middle; pointer-events: none; }
    #sidebar {
        width: 300px;
        min-height: 400px;
        border: 2px solid #008659;
        border-radius: 10px;
        padding: 20px;
        margin-left: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #auth-section { text-align: center; margin-bottom: 15px; }
    #auth-section button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 14px; }
    #login-btn { background-color: #008659; }
    #logout-btn { background-color: #555; }
    #admin-status { font-weight: bold; color: #008659; }
    #info-panel { flex-grow: 1; display: flex; flex-direction: column; }
    #info-panel-content { flex-grow: 1; overflow-y: auto; }
    #info-panel h2, #info-panel p { text-align: center; margin: 0 0 10px 0; color: #008659; }
    #info-panel ul { list-style-type: none; padding: 0; margin: 0; }
    #info-panel li { background-color: #f0f8f2; margin-bottom: 8px; padding: 10px; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .delete-btn { background: #008659; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; padding: 3px 8px; }
    #add-attraction-form { margin-top: 15px; display: flex; }
    #add-attraction-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
    #add-attraction-btn { background: #008659; color: white; border: none; border-radius: 4px; margin-left: 5px; padding: 8px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>台北捷運 - 松山新店線 (G)</h1>

<div id="map-container">
    <div id="map">
        <svg id="green-line-svg" width="100%" height="150"></svg>
    </div>
    <div id="sidebar">
        <div id="auth-section">
            <button id="login-btn">管理員登入</button>
            <button id="logout-btn" style="display:none;">登出</button>
            <p id="admin-status" style="display:none;">管理員模式</p>
        </div>
        <div id="info-panel">
            <div id="info-panel-content">
                <h2>附近景點</h2>
                <p>請點選站點</p>
                <ul></ul>
            </div>
            <div id="add-attraction-form" style="display:none;">
                <input type="text" id="add-attraction-input" placeholder="輸入新景點...">
                <button id="add-attraction-btn">新增</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBALS ---
document.addEventListener('DOMContentLoaded', main);
const LOCAL_STORAGE_KEY = 'greenLineMapData'; // Unique key for this line
let isAdmin = false;
let currentStationId = null;
let stations = [];

// --- MAIN FUNCTION ---
function main() {
    initData();
    setupEventListeners();
    drawMap();
}

// --- DATA MANAGEMENT ---
function initData() {
    const savedStations = localStorage.getItem(LOCAL_STORAGE_KEY);
    if (savedStations) {
        stations = JSON.parse(savedStations);
    } else {
        stations = getDefaultStations();
        saveData();
    }
}

function saveData() {
    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(stations));
}

// --- AUTH & EVENT LISTENERS ---
function setupEventListeners() {
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('logout-btn').addEventListener('click', logout);
    document.getElementById('add-attraction-btn').addEventListener('click', addAttraction);
}

function login() {
    const password = prompt('請輸入管理員密碼:');
    if (password === '123') {
        isAdmin = true;
        toggleAdminView(true);
        if(currentStationId) updateInfoPanel(currentStationId);
    } else {
        alert('密碼錯誤!');
    }
}

function logout() {
    isAdmin = false;
    toggleAdminView(false);
    if(currentStationId) updateInfoPanel(currentStationId);
}

function toggleAdminView(isAdminState) {
    document.getElementById('login-btn').style.display = isAdminState ? 'none' : 'block';
    document.getElementById('logout-btn').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('admin-status').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('add-attraction-form').style.display = isAdminState && currentStationId ? 'flex' : 'none';
}

// --- UI & CRUD ---
function updateInfoPanel(stationId) {
    currentStationId = stationId;
    const station = stations.find(s => s.id === stationId);
    const panel = document.getElementById('info-panel-content');
    panel.innerHTML = `<h2>${station.name}</h2><p>(${station.id})</p><ul></ul>`;
    const list = panel.querySelector('ul');

    if (station.attractions && station.attractions.length > 0) {
        station.attractions.forEach(attraction => {
            const li = document.createElement('li');
            li.textContent = attraction;
            if (isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteAttraction(attraction);
                li.appendChild(deleteBtn);
            }
            list.appendChild(li);
        });
    } else {
        list.innerHTML = '<li>尚無景點資訊</li>';
    }
    document.getElementById('add-attraction-form').style.display = isAdmin ? 'flex' : 'none';
}

function addAttraction() {
    const input = document.getElementById('add-attraction-input');
    const newAttraction = input.value.trim();
    if (!newAttraction || !currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        if (!stationToUpdate.attractions) stationToUpdate.attractions = [];
        stationToUpdate.attractions.push(newAttraction);
        saveData();
        updateInfoPanel(currentStationId);
    }
    input.value = '';
}

function deleteAttraction(attractionName) {
    if (!currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        stationToUpdate.attractions = stationToUpdate.attractions.filter(a => a !== attractionName);
        saveData();
        updateInfoPanel(currentStationId);
    }
}

// --- MAP DRAWING ---
function drawMap() {
    const svg = document.getElementById("green-line-svg");
    const svgWidth = stations.length * 70;
    svg.setAttribute("width", svgWidth);
    const lineY = 75;

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", 30); line.setAttribute("y1", lineY);
    line.setAttribute("x2", svgWidth - 30); line.setAttribute("y2", lineY);
    line.setAttribute("stroke", "#008659"); line.setAttribute("stroke-width", 8);
    svg.appendChild(line);

    stations.forEach((station, index) => {
        const x = index * 70 + 30;
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("class", "station-circle");
        circle.setAttribute("cx", x); circle.setAttribute("cy", lineY); circle.setAttribute("r", 10);
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("class", "station-text");
        text.setAttribute("x", x); text.setAttribute("y", lineY + 35);
        text.textContent = station.name;
        svg.appendChild(text);

        circle.addEventListener("click", () => updateInfoPanel(station.id));
    });
}

// --- DEFAULT DATA ---
function getDefaultStations() {
    return [
        { id: 'G01', name: '新店', attractions: ['碧潭風景區'] },
        { id: 'G02', name: '新店區公所', attractions: [] },
        { id: 'G03', name: '七張', attractions: ['(可轉乘小碧潭支線)'] },
        { id: 'G04', name: '大坪林', attractions: ['(可轉乘環狀線)'] },
        { id: 'G05', name: '景美', attractions: ['景美夜市'] },
        { id: 'G06', name: '萬隆', attractions: [] },
        { id: 'G07', name: '公館', attractions: ['台灣大學', '公館商圈'] },
        { id: 'G08', name: '台電大樓', attractions: ['師大夜市'] },
        { id: 'G09', name: '古亭', attractions: ['(可轉乘中和新蘆線)'] },
        { id: 'G10', name: '中正紀念堂', attractions: ['中正紀念堂', '(可轉乘淡水信義線)'] },
        { id: 'G11', name: '小南門', attractions: [] },
        { id: 'G12', name: '西門', attractions: ['西門町', '(可轉乘板南線)'] },
        { id: 'G13', name: '北門', attractions: ['機場捷運台北車站'] },
        { id: "G14", name: "中山", attractions: ["中山地下街", "(可轉乘淡水信義線)"] },
        { id: "G15", name: "松江南京", attractions: ["(可轉乘中和新蘆線)"] },
        { id: "G16", name: "南京復興", attractions: ["(可轉乘文湖線)"] },
        { id: 'G17', name: '台北小巨蛋', attractions: ['台北小巨蛋'] },
        { id: 'G18', name: '南京三民', attractions: [] },
        { id: 'G19', name: '松山', attractions: ['饒河街夜市', '松山車站'] }
    ];
}

</script>
</body>
</html>
