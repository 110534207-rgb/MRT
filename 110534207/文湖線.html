<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台北捷運文湖線 路線圖</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh; margin: 0; background-color: #f0f2f5; }
    h1 { color: #8B4513; }
    #map-container { display: flex; align-items: center; width: 95%; max-width: 1400px; }
    #map { width: 100%; overflow-x: auto; padding: 20px 0; }
    .station-circle { cursor: pointer; fill: white; stroke: #8B4513; stroke-width: 4; transition: r 0.2s ease-in-out; }
    .station-circle:hover { r: 12; }
    .station-text { font-size: 12px; font-weight: bold; text-anchor: middle; pointer-events: none; }
    #sidebar {
        width: 300px;
        min-height: 400px;
        border: 2px solid #8B4513;
        border-radius: 10px;
        padding: 20px;
        margin-left: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #auth-section { text-align: center; margin-bottom: 15px; }
    #auth-section button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 14px; }
    #login-btn { background-color: #8B4513; color: white; }
    #logout-btn { background-color: #e41c1c; }
    #admin-status { font-weight: bold; color: #e41c1c; }
    #info-panel { flex-grow: 1; display: flex; flex-direction: column; }
    #info-panel-content { flex-grow: 1; overflow-y: auto; }
    #info-panel h2, #info-panel p { text-align: center; margin: 0 0 10px 0; color: #8B4513; }
    #info-panel ul { list-style-type: none; padding: 0; margin: 0; }
    #info-panel li { background-color: #e6f2ff; margin-bottom: 8px; padding: 10px; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .delete-btn { background: #e41c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; padding: 3px 8px; }
    #add-attraction-form { margin-top: 15px; display: flex; }
    #add-attraction-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
    #add-attraction-btn { background: #8B4513; color: white; border: none; border-radius: 4px; margin-left: 5px; padding: 8px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>台北捷運 - 文湖線</h1>

<div id="map-container">
    <div id="map">
        <svg id="brown-line-svg" width="100%" height="150"></svg>
    </div>
    <div id="sidebar">
        <div id="auth-section">
            <button id="login-btn">管理員登入</button>
            <button id="logout-btn" style="display:none;">登出</button>
            <p id="admin-status" style="display:none;">管理員模式</p>
        </div>
        <div id="info-panel">
            <div id="info-panel-content">
                <h2>附近景點</h2>
                <p>請點選站點</p>
                <ul></ul>
            </div>
            <div id="add-attraction-form" style="display:none;">
                <input type="text" id="add-attraction-input" placeholder="輸入新景點...">
                <button id="add-attraction-btn">新增</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBALS ---
document.addEventListener('DOMContentLoaded', main);
const LOCAL_STORAGE_KEY = 'brownLineMapData'; // Unique key
let isAdmin = false;
let currentStationId = null;
let stations = [];

// --- MAIN FUNCTION ---
function main() {
    initData();
    setupEventListeners();
    drawMap();
}

// --- DATA MANAGEMENT ---
function initData() {
    const savedStations = localStorage.getItem(LOCAL_STORAGE_KEY);
    if (savedStations) {
        stations = JSON.parse(savedStations);
    } else {
        stations = getDefaultStations();
        saveData();
    }
}

function saveData() {
    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(stations));
}

// --- AUTH & EVENT LISTENERS ---
function setupEventListeners() {
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('logout-btn').addEventListener('click', logout);
    document.getElementById('add-attraction-btn').addEventListener('click', addAttraction);
}

function login() {
    const password = prompt('請輸入管理員密碼:');
    if (password === '123') {
        isAdmin = true;
        toggleAdminView(true);
        if(currentStationId) updateInfoPanel(currentStationId);
    } else {
        alert('密碼錯誤!');
    }
}

function logout() {
    isAdmin = false;
    toggleAdminView(false);
    if(currentStationId) updateInfoPanel(currentStationId);
}

function toggleAdminView(isAdminState) {
    document.getElementById('login-btn').style.display = isAdminState ? 'none' : 'block';
    document.getElementById('logout-btn').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('admin-status').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('add-attraction-form').style.display = isAdminState && currentStationId ? 'flex' : 'none';
}

// --- UI & CRUD ---
function updateInfoPanel(stationId) {
    currentStationId = stationId;
    const station = stations.find(s => s.id === stationId);
    const panel = document.getElementById('info-panel-content');
    panel.innerHTML = `<h2>${station.name}</h2><p>(${station.id})</p><ul></ul>`;
    const list = panel.querySelector('ul');

    if (station.attractions && station.attractions.length > 0) {
        station.attractions.forEach(attraction => {
            const li = document.createElement('li');
            li.textContent = attraction;
            if (isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteAttraction(attraction);
                li.appendChild(deleteBtn);
            }
            list.appendChild(li);
        });
    } else {
        list.innerHTML = '<li>尚無景點資訊</li>';
    }
    document.getElementById('add-attraction-form').style.display = isAdmin ? 'flex' : 'none';
}

function addAttraction() {
    const input = document.getElementById('add-attraction-input');
    const newAttraction = input.value.trim();
    if (!newAttraction || !currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        if (!stationToUpdate.attractions) stationToUpdate.attractions = [];
        stationToUpdate.attractions.push(newAttraction);
        saveData();
        updateInfoPanel(currentStationId);
    }
    input.value = '';
}

function deleteAttraction(attractionName) {
    if (!currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        stationToUpdate.attractions = stationToUpdate.attractions.filter(a => a !== attractionName);
        saveData();
        updateInfoPanel(currentStationId);
    }
}

// --- MAP DRAWING ---
function drawMap() {
    const svg = document.getElementById("brown-line-svg");
    const svgWidth = stations.length * 80; // Increased spacing to 80px per station
    svg.setAttribute("width", svgWidth);
    const lineY = 75;

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", 40); line.setAttribute("y1", lineY);
    line.setAttribute("x2", svgWidth - 40); line.setAttribute("y2", lineY);
    line.setAttribute("stroke", "#8B4513"); line.setAttribute("stroke-width", 8);
    svg.appendChild(line);

    stations.forEach((station, index) => {
        const x = index * 80 + 40; // Adjusted x-coordinate for 80px spacing
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("class", "station-circle");
        circle.setAttribute("cx", x); circle.setAttribute("cy", lineY); circle.setAttribute("r", 10);
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("class", "station-text");
        text.setAttribute("x", x); text.setAttribute("y", lineY + 35);
        text.textContent = station.name;
        svg.appendChild(text);

        circle.addEventListener("click", () => updateInfoPanel(station.id));
    });
}

// --- DEFAULT DATA ---
function getDefaultStations() {
    return [
        { id: 'BR01', name: '動物園', attractions: ['台北市立動物園'] },
        { id: 'BR02', name: '木柵', attractions: ['貓空纜車'] },
        { id: 'BR03', name: '萬芳社區', attractions: ['萬芳公園'] },
        { id: 'BR04', name: '萬芳醫院', attractions: ['萬芳醫院'] },
        { id: 'BR05', name: '辛亥', attractions: ['辛亥生態公園'] },
        { id: 'BR06', name: '麟光', attractions: ['富陽自然生態公園'] },
        { id: 'BR07', name: '六張犁', attractions: ['富陽自然生態公園'] },
        { id: 'BR08', name: '科技大樓', attractions: ['台北世貿中心'] },
        { id: 'BR09', name: '大安', attractions: ['大安森林公園', '(可轉乘淡水信義線)'] },
        { id: 'BR10', name: '忠孝復興', attractions: ['SOGO百貨', '(可轉乘板南線)'] },
        { id: 'BR11', name: '南京復興', attractions: ['遼寧夜市', '(可轉乘松山新店線)'] },
        { id: 'BR12', name: '中山國中', attractions: ['榮星花園'] },
        { id: 'BR13', name: '松山機場', attractions: ['松山機場觀景台'] },
        { id: 'BR14', name: '大直', attractions: ['美麗華百樂園'] },
        { id: 'BR15', name: '劍南路', attractions: ['內湖夜市'] },
        { id: 'BR16', name: '西湖', attractions: ['內湖737夜市'] },
        { id: 'BR17', name: '港墘', attractions: ['內湖科技園區'] },
        { id: 'BR18', name: '文德', attractions: ['碧湖公園'] },
        { id: 'BR19', name: '內湖', attractions: ['內湖花市'] },
        { id: 'BR20', name: '大湖公園', attractions: ['大湖公園'] },
        { id: 'BR21', name: '葫洲', attractions: ['碧山巖'] },
        { id: 'BR22', name: '東湖', attractions: ['東湖公園'] },
        { id: 'BR23', name: '南港軟體園區', attractions: ['南港軟體園區'] },
        { id: 'BR24', name: '南港展覽館', attractions: ['台北南港展覽館', '(可轉乘板南線)'] }
    ].reverse();
}

</script>
</body>
</html>