<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台北捷運淡水信義線路線圖 (可編輯版)</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh; margin: 0; background-color: #f0f2f5; }
    h1 { color: #e41c1c; }
    #map-container { display: flex; align-items: center; width: 95%; max-width: 1600px; }
    #map { width: 100%; overflow-x: auto; padding: 20px 0; }
    .station-circle { cursor: pointer; fill: white; stroke: #e41c1c; stroke-width: 4; transition: r 0.2s ease-in-out; }
    .station-circle:hover { r: 12; }
    .station-text { font-size: 12px; font-weight: bold; text-anchor: middle; pointer-events: none; }
    #sidebar {
        width: 300px;
        min-height: 400px;
        border: 2px solid #e41c1c;
        border-radius: 10px;
        padding: 20px;
        margin-left: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #auth-section { text-align: center; margin-bottom: 15px; }
    #auth-section button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 14px; }
    #login-btn { background-color: #e41c1c; }
    #logout-btn { background-color: #555; }
    #admin-status { font-weight: bold; color: #e41c1c; }
    #info-panel { flex-grow: 1; display: flex; flex-direction: column; }
    #info-panel-content { flex-grow: 1; overflow-y: auto; }
    #info-panel h2, #info-panel p { text-align: center; margin: 0 0 10px 0; color: #e41c1c; }
    #info-panel ul { list-style-type: none; padding: 0; margin: 0; }
    #info-panel li { background-color: #fee; margin-bottom: 8px; padding: 10px; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .delete-btn { background: #e41c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; padding: 3px 8px; }
    #add-attraction-form { margin-top: 15px; display: flex; }
    #add-attraction-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
    #add-attraction-btn { background: #e41c1c; color: white; border: none; border-radius: 4px; margin-left: 5px; padding: 8px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>台北捷運 - 淡水信義線 (R)</h1>

<div id="map-container">
    <div id="map">
        <svg id="red-line-svg" width="100%" height="150"></svg>
    </div>
    <div id="sidebar">
        <div id="auth-section">
            <button id="login-btn">管理員登入</button>
            <button id="logout-btn" style="display:none;">登出</button>
            <p id="admin-status" style="display:none;">管理員模式</p>
        </div>
        <div id="info-panel">
            <div id="info-panel-content">
                <h2>附近景點</h2>
                <p>請點選站點</p>
                <ul></ul>
            </div>
            <div id="add-attraction-form" style="display:none;">
                <input type="text" id="add-attraction-input" placeholder="輸入新景點...">
                <button id="add-attraction-btn">新增</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBALS ---
document.addEventListener('DOMContentLoaded', main);
const LOCAL_STORAGE_KEY = 'redLineMapData'; // Unique key for this line
let isAdmin = false;
let currentStationId = null;
let stations = [];

// --- MAIN FUNCTION ---
function main() {
    initData();
    setupEventListeners();
    drawMap();
}

// --- DATA MANAGEMENT ---
function initData() {
    const savedStations = localStorage.getItem(LOCAL_STORAGE_KEY);
    if (savedStations) {
        stations = JSON.parse(savedStations);
    } else {
        stations = getDefaultStations();
        saveData();
    }
}

function saveData() {
    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(stations));
}

// --- AUTH & EVENT LISTENERS ---
function setupEventListeners() {
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('logout-btn').addEventListener('click', logout);
    document.getElementById('add-attraction-btn').addEventListener('click', addAttraction);
}

function login() {
    const password = prompt('請輸入管理員密碼:');
    if (password === '123') {
        isAdmin = true;
        toggleAdminView(true);
        if(currentStationId) updateInfoPanel(currentStationId);
    } else {
        alert('密碼錯誤!');
    }
}

function logout() {
    isAdmin = false;
    toggleAdminView(false);
    if(currentStationId) updateInfoPanel(currentStationId);
}

function toggleAdminView(isAdminState) {
    document.getElementById('login-btn').style.display = isAdminState ? 'none' : 'block';
    document.getElementById('logout-btn').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('admin-status').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('add-attraction-form').style.display = isAdminState && currentStationId ? 'flex' : 'none';
}

// --- UI & CRUD ---
function updateInfoPanel(stationId) {
    currentStationId = stationId;
    const station = stations.find(s => s.id === stationId);
    const panel = document.getElementById('info-panel-content');
    panel.innerHTML = `<h2>${station.name}</h2><p>(${station.id})</p><ul></ul>`;
    const list = panel.querySelector('ul');

    if (station.attractions && station.attractions.length > 0) {
        station.attractions.forEach(attraction => {
            const li = document.createElement('li');
            li.textContent = attraction;
            if (isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteAttraction(attraction);
                li.appendChild(deleteBtn);
            }
            list.appendChild(li);
        });
    } else {
        list.innerHTML = '<li>尚無景點資訊</li>';
    }
    document.getElementById('add-attraction-form').style.display = isAdmin ? 'flex' : 'none';
}

function addAttraction() {
    const input = document.getElementById('add-attraction-input');
    const newAttraction = input.value.trim();
    if (!newAttraction || !currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        if (!stationToUpdate.attractions) stationToUpdate.attractions = [];
        stationToUpdate.attractions.push(newAttraction);
        saveData();
        updateInfoPanel(currentStationId);
    }
    input.value = '';
}

function deleteAttraction(attractionName) {
    if (!currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        stationToUpdate.attractions = stationToUpdate.attractions.filter(a => a !== attractionName);
        saveData();
        updateInfoPanel(currentStationId);
    }
}

// --- MAP DRAWING ---
function drawMap() {
    const svg = document.getElementById("red-line-svg");
    const svgWidth = stations.length * 65; // Adjusted spacing for more stations
    svg.setAttribute("width", svgWidth);
    const lineY = 75;

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", 30); line.setAttribute("y1", lineY);
    line.setAttribute("x2", svgWidth - 30); line.setAttribute("y2", lineY);
    line.setAttribute("stroke", "#e41c1c"); line.setAttribute("stroke-width", 8);
    svg.appendChild(line);

    stations.forEach((station, index) => {
        const x = index * 65 + 30;
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("class", "station-circle");
        circle.setAttribute("cx", x); circle.setAttribute("cy", lineY); circle.setAttribute("r", 10);
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("class", "station-text");
        text.setAttribute("x", x); text.setAttribute("y", lineY + 35);
        text.textContent = station.name;
        svg.appendChild(text);

        circle.addEventListener("click", () => updateInfoPanel(station.id));
    });
}

// --- DEFAULT DATA ---
function getDefaultStations() {
    return [
        { id: "R02", name: "象山", attractions: ["象山親山步道"] },
        { id: "R03", name: "台北101/世貿", attractions: ["台北101觀景台"] },
        { id: "R04", name: "信義安和", attractions: ["臨江街夜市"] },
        { id: "R05", name: "大安", attractions: ["大安森林公園"] },
        { id: "R06", name: "大安森林公園", attractions: ["大安森林公園"] },
        { id: "R07", name: "東門", attractions: ["永康街商圈"] },
        { id: "R08", name: "中正紀念堂", attractions: ["中正紀念堂", "國家兩廳院"] },
        { id: "R09", name: "台大醫院", attractions: ["二二八和平公園"] },
        { id: "R10", name: "台北車站", attractions: ["京站時尚廣場"] },
        { id: "R11", name: "中山", attractions: ["中山地下街", "新光三越"] },
        { id: "R12", name: "雙連", attractions: ["雙連市場"] },
        { id: "R13", name: "民權西路", attractions: ["晴光市場"] },
        { id: "R14", name: "圓山", attractions: ["圓山花博公園", "台北市立美術館"] },
        { id: "R15", name: "劍潭", attractions: ["士林夜市"] },
        { id: "R16", name: "士林", attractions: ["士林官邸"] },
        { id: "R17", name: "芝山", attractions: ["天母SOGO"] },
        { id: "R18", name: "明德", attractions: [] },
        { id: "R19", name: "石牌", attractions: ["石牌夜市"] },
        { id: "R20", name: "唭哩岸", attractions: [] },
        { id: "R21", name: "奇岩", attractions: [] },
        { id: "R22", name: "北投", attractions: ["北投溫泉博物館"] },
        { id: "R23", name: "復興崗", attractions: [] },
        { id: "R24", name: "忠義", attractions: [] },
        { id: "R25", name: "關渡", attractions: ["關渡宮", "關渡自然公園"] },
        { id: "R26", name: "竹圍", attractions: [] },
        { id: "R27", name: "紅樹林", attractions: ["紅樹林生態保護區"] },
        { id: "R28", name: "淡水", attractions: ["淡水老街", "淡水漁人碼頭"] }
    ].reverse(); // To draw from Tamsui to Xiangshan
}

</script>
</body>
</html>
