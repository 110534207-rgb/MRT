<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台北捷運板南線路線圖 (可編輯版)</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh; margin: 0; background-color: #f0f2f5; }
    h1 { color: #007bff; }
    #map-container { display: flex; align-items: center; width: 95%; max-width: 1400px; }
    #map { width: 100%; overflow-x: auto; padding: 20px 0; }
    .station-circle { cursor: pointer; fill: white; stroke: #007bff; stroke-width: 4; transition: r 0.2s ease-in-out; }
    .station-circle:hover { r: 12; }
    .station-text { font-size: 12px; font-weight: bold; text-anchor: middle; pointer-events: none; }
    #sidebar {
        width: 300px;
        min-height: 400px;
        border: 2px solid #007bff;
        border-radius: 10px;
        padding: 20px;
        margin-left: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #auth-section { text-align: center; margin-bottom: 15px; }
    #auth-section button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 14px; }
    #login-btn { background-color: #007bff; }
    #logout-btn { background-color: #e41c1c; }
    #admin-status { font-weight: bold; color: #e41c1c; }
    #info-panel { flex-grow: 1; display: flex; flex-direction: column; }
    #info-panel-content { flex-grow: 1; overflow-y: auto; }
    #info-panel h2, #info-panel p { text-align: center; margin: 0 0 10px 0; color: #007bff; }
    #info-panel ul { list-style-type: none; padding: 0; margin: 0; }
    #info-panel li { background-color: #e6f2ff; margin-bottom: 8px; padding: 10px; border-radius: 5px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .delete-btn { background: #e41c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; padding: 3px 8px; }
    #add-attraction-form { margin-top: 15px; display: flex; }
    #add-attraction-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
    #add-attraction-btn { background: #007bff; color: white; border: none; border-radius: 4px; margin-left: 5px; padding: 8px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>台北捷運 - 板南線 (可編輯)</h1>

<div id="map-container">
    <div id="map">
        <svg id="bannan-line-svg" width="100%" height="150"></svg>
    </div>
    <div id="sidebar">
        <div id="auth-section">
            <button id="login-btn">管理員登入</button>
            <button id="logout-btn" style="display:none;">登出</button>
            <p id="admin-status" style="display:none;">管理員模式</p>
        </div>
        <div id="info-panel">
            <div id="info-panel-content">
                <h2>附近景點</h2>
                <p>請點選站點</p>
                <ul></ul>
            </div>
            <div id="add-attraction-form" style="display:none;">
                <input type="text" id="add-attraction-input" placeholder="輸入新景點...">
                <button id="add-attraction-btn">新增</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBALS ---
document.addEventListener('DOMContentLoaded', main);
const LOCAL_STORAGE_KEY = 'singleLineMapData';
let isAdmin = false;
let currentStationId = null;
let stations = [];

// --- MAIN FUNCTION ---
function main() {
    initData();
    setupEventListeners();
    drawMap();
}

// --- DATA MANAGEMENT ---
function initData() {
    const savedStations = localStorage.getItem(LOCAL_STORAGE_KEY);
    if (savedStations) {
        stations = JSON.parse(savedStations);
    } else {
        stations = getDefaultStations();
        saveData();
    }
}

function saveData() {
    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(stations));
}

// --- AUTH & EVENT LISTENERS ---
function setupEventListeners() {
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('logout-btn').addEventListener('click', logout);
    document.getElementById('add-attraction-btn').addEventListener('click', addAttraction);
}

function login() {
    const password = prompt('請輸入管理員密碼:');
    if (password === '123') {
        isAdmin = true;
        toggleAdminView(true);
        if(currentStationId) updateInfoPanel(currentStationId);
    } else {
        alert('密碼錯誤!');
    }
}

function logout() {
    isAdmin = false;
    toggleAdminView(false);
    if(currentStationId) updateInfoPanel(currentStationId);
}

function toggleAdminView(isAdminState) {
    document.getElementById('login-btn').style.display = isAdminState ? 'none' : 'block';
    document.getElementById('logout-btn').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('admin-status').style.display = isAdminState ? 'block' : 'none';
    document.getElementById('add-attraction-form').style.display = isAdminState && currentStationId ? 'flex' : 'none';
}

// --- UI & CRUD ---
function updateInfoPanel(stationId) {
    currentStationId = stationId;
    const station = stations.find(s => s.id === stationId);
    const panel = document.getElementById('info-panel-content');
    panel.innerHTML = `<h2>${station.name}</h2><p>附近景點</p><ul></ul>`;
    const list = panel.querySelector('ul');

    if (station.attractions && station.attractions.length > 0) {
        station.attractions.forEach(attraction => {
            const li = document.createElement('li');
            li.textContent = attraction;
            if (isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '刪除';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteAttraction(attraction);
                li.appendChild(deleteBtn);
            }
            list.appendChild(li);
        });
    } else {
        list.innerHTML = '<li>尚無景點資訊</li>';
    }
    document.getElementById('add-attraction-form').style.display = isAdmin ? 'flex' : 'none';
}

function addAttraction() {
    const input = document.getElementById('add-attraction-input');
    const newAttraction = input.value.trim();
    if (!newAttraction || !currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        if (!stationToUpdate.attractions) stationToUpdate.attractions = [];
        stationToUpdate.attractions.push(newAttraction);
        saveData();
        updateInfoPanel(currentStationId);
    }
    input.value = '';
}

function deleteAttraction(attractionName) {
    if (!currentStationId) return;
    const stationToUpdate = stations.find(s => s.id === currentStationId);

    if (stationToUpdate) {
        stationToUpdate.attractions = stationToUpdate.attractions.filter(a => a !== attractionName);
        saveData();
        updateInfoPanel(currentStationId);
    }
}

// --- MAP DRAWING ---
function drawMap() {
    const svg = document.getElementById("bannan-line-svg");
    const svgWidth = stations.length * 60;
    svg.setAttribute("width", svgWidth);
    const lineY = 75;

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", 30); line.setAttribute("y1", lineY);
    line.setAttribute("x2", svgWidth - 30); line.setAttribute("y2", lineY);
    line.setAttribute("stroke", "#007bff"); line.setAttribute("stroke-width", 8);
    svg.appendChild(line);

    stations.forEach((station, index) => {
        const x = index * 60 + 30;
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("class", "station-circle");
        circle.setAttribute("cx", x); circle.setAttribute("cy", lineY); circle.setAttribute("r", 10);
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("class", "station-text");
        text.setAttribute("x", x); text.setAttribute("y", lineY + 35);
        text.textContent = station.name;
        svg.appendChild(text);

        circle.addEventListener("click", () => updateInfoPanel(station.id));
    });
}

// --- DEFAULT DATA ---
function getDefaultStations() {
    return [
        { id: "BL01", name: "頂埔", attractions: ["頂埔科技園區"] },
        { id: "BL02", name: "永寧", attractions: ["承天禪寺"] },
        { id: "BL03", name: "土城", attractions: ["土城桐花公園"] },
        { id: "BL04", name: "海山", attractions: ["新北市立土城醫院"] },
        { id: "BL05", name: "亞東醫院", attractions: ["遠東通訊園區"] },
        { id: "BL06", name: "府中", attractions: ["林家花園", "府中商圈"] },
        { id: "BL07", name: "板橋", attractions: ["新北耶誕城", "板橋大遠百"] },
        { id: "BL08", name: "新埔", attractions: ["新埔花市"] },
        { id: "BL09", name: "江子翠", attractions: ["江子翠河濱公園"] },
        { id: "BL10", name: "龍山寺", attractions: ["龍山寺", "剝皮寮歷史街區"] },
        { id: "BL11", name: "西門", attractions: ["西門町", "紅樓劇場"] },
        { id: "BL12", name: "台北車站", attractions: ["站前地下街", "國立臺灣博物館"] },
        { id: "BL13", name: "善導寺", attractions: ["華山1914文創園區"] },
        { id: "BL14", name: "忠孝新生", attractions: ["光華商場", "三創生活園區"] },
        { id: "BL15", name: "忠孝復興", attractions: ["SOGO百貨", "微風廣場"] },
        { id: "BL16", name: "忠孝敦化", attractions: ["東區地下街", "誠品敦南店"] },
        { id: "BL17", name: "國父紀念館", attractions: ["國父紀念館", "松山文創園區"] },
        { id: "BL18", name: "市政府", attractions: ["台北101", "信義商圈"] },
        { id: "BL19", name: "永春", attractions: ["虎山親山步道"] },
        { id: "BL20", name: "後山埤", attractions: ["五分埔商圈"] },
        { id: "BL21", name: "昆陽", attractions: ["台北流行音樂中心"] },
        { id: "BL22", name: "南港", attractions: ["南港車站CITYLINK"] },
        { id: "BL23", name: "南港展覽館", attractions: ["台北南港展覽館"] }
    ];
}

</script>
</body>
</html>
